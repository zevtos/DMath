# ADR-0003: API версионирование и документация

## Статус

Принято

## Контекст

Проект Dmath использует гибридную архитектуру с Node.js шлюзом и Java backend для алгоритмов. Необходимо обеспечить:

- Совместимость API при изменениях
- Автоматическую генерацию документации
- Стандартизированную обработку ошибок
- Возможность эволюции API без breaking changes
- Проксирование запросов между Node.js и Java backend

## Решение

### 1. Архитектура API

Использовать Node.js как API Gateway с проксированием к Java backend:

- **Node.js Gateway** (порт 3000) - основной API, аутентификация, проксирование
- **Java Backend** (порт 8080) - алгоритмы, вычисления, база данных
- **Frontend** (порт 3001) - Next.js приложение

### 2. API версионирование

Использовать URL-based версионирование с префиксом `/api/v1/`:

- Все API эндпоинты будут иметь версию в URL
- Планируется поддержка v2, v3 и т.д. при необходимости
- Обратная совместимость через поддержку старых версий

### 3. Документация API

Использовать OpenAPI 3.0 с автоматической генерацией:

- **Node.js Gateway**: Swagger UI на `/api/docs`
- **Java Backend**: SpringDoc OpenAPI на `/swagger-ui.html`
- Объединенная документация через Node.js gateway

### 4. Обработка ошибок

Использовать стандартизированный формат ошибок:

- JSON API Error Format (RFC 7807)
- Единообразная обработка ошибок на уровне Node.js gateway
- Проксирование ошибок от Java backend

### 5. Структура API

```
Node.js Gateway (3000):
/api/v1/
├── /auth/               # Аутентификация и авторизация
├── /algorithms/         # Прокси к Java backend
│   ├── /graphs/         # → Java: /api/v1/algorithms/graphs/
│   ├── /transport/      # → Java: /api/v1/algorithms/transport/
│   └── /neural/         # → Java: /api/v1/algorithms/neural/
├── /health              # Health check
└── /docs                # API документация

Java Backend (8080):
/api/v1/
├── /algorithms/         # Реализация алгоритмов
├── /health              # Health check
└── /actuator/           # Spring Boot Actuator
```

## Последствия

### Положительные

- Четкое разделение ответственности между Node.js и Java
- Единая точка входа для фронтенда через Node.js gateway
- Гибкость в выборе технологий (Node.js для API, Java для алгоритмов)
- Возможность независимого масштабирования компонентов
- Автоматическая документация на обоих уровнях
- Стандартизированная обработка ошибок
- Легкость интеграции для фронтенда

### Отрицательные

- Дополнительная сложность архитектуры
- Необходимость поддержки двух серверов
- Потенциальные задержки при проксировании
- Дополнительные зависимости и настройки

## Альтернативы

- **Только Java backend**: Отклонено из-за требований ТЗ использовать Node.js
- **Только Node.js backend**: Отклонено из-за наличия готовых Java алгоритмов
- **Микросервисная архитектура**: Отклонено из-за избыточной сложности для проекта
- **Прямое подключение фронтенда к Java**: Отклонено из-за требований ТЗ
